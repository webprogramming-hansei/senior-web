<html>
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <title>피드 API 강의</title>
  </head>
  <body>
    <h1>피드 목록</h1>
    <div class="container">
      <div id="ulFeeds" class="row row-cols-2">
      </div>
    </div>
    <p id="feedDetail"></p>
    <div>
      <button id="btnGetFeeds" onclick="fetchFeeds();">
        피드 목록 가져오기
      </button>
      <button id="btnGetFeedDetail" onclick="javascript:fetchFeedDetail();">
        피드 상세 정보
      </button>
      <button id="btnPostFeeds" onclick="javascript:createFeed();">
        피드 등록하기
      </button>
    </div>
    <ul>
      <!-- 피드목록을 가져와서 보여주기 -->
    </ul>

    <script>
      function fetchFeeds() {
        const ulFeeds = document.querySelector("#ulFeeds");

        fetch("http://localhost:4000/feeds")
          .then(function (response) {
            return response.json();
          })
          .then(function (json) {
            const { body } = json;
            const { feeds } = body;
            // for (let i = 0; i < feeds.length; i++) {
            //   console.log(feeds[i].content, feeds[i].tags);
            // }
              // <div class="col">Column</div>
            feeds.forEach((feed) => {
              ulFeeds.innerHTML += 
              `<div class="card">
                <div class="card-body">
                  <h5 class="card-title">${feed.id}</h5>
                  <p class="card-text">${feed.content}</p>
                  <a class="btn btn-primary" onclick="fetchFeedDetail(${feed.id});">상세보기</a>
                </div>
              </div>`;


              console.log("피드목록", feed.content, feed.tag, feed.id);
            });
          })
          .catch((e) => {});
      }

      function fetchFeedDetail(id) {
        const elFeedDetail = document.querySelector("#feedDetail");

        fetch(`http://localhost:4000/feeds/${id}`)
          .then(function (response) {
            return response.json();
          })
          .then(function (json) {
            const { body } = json;
            const { feed } = body;
            elFeedDetail.innerHTML = `[${feed.id}] 콘텐트: ${feed.content}, 태그: ${feed.tag}`;
            console.log("피드상세", feed.content, feed.tag, feed.id);
          })
          .catch((e) => {});
      }

      function createFeed() {
        fetch("http://localhost:4000/feeds", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            content: "새로운 컨텐트",
            tags: "#강의 #restapi",
          }),
        })
          .then(function (response) {
            return response.json();
          })
          .then(function (json) {
            console.log(json);
          })
          .catch((e) => {});
      }
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
